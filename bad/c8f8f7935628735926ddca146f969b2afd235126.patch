From c8f8f7935628735926ddca146f969b2afd235126 Mon Sep 17 00:00:00 2001
From: BrunoSX <brunodeveloper85@gmail.com>
Date: Sat, 15 Mar 2025 16:56:30 -0300
Subject: [PATCH] amstream: Use naive copy instead memcpy (Fix crash)

---
 dlls/amstream/ddrawstream.c                      | 4 ++--
 dlls/comctl32/idb_view_small.bmp:Zone.Identifier | 3 ---
 2 files changed, 2 insertions(+), 5 deletions(-)
 delete mode 100644 dlls/comctl32/idb_view_small.bmp:Zone.Identifier

diff --git a/dlls/amstream/ddrawstream.c b/dlls/amstream/ddrawstream.c
index dc77cb87..61321089 100755
--- a/dlls/amstream/ddrawstream.c
+++ b/dlls/amstream/ddrawstream.c
@@ -111,7 +111,7 @@ static HRESULT process_update(struct ddraw_sample *sample, int stride, BYTE *poi
         STREAM_TIME start_time, STREAM_TIME end_time)
 {
     DDSURFACEDESC desc;
-    DWORD row_size;
+    DWORD row_size, x;
     const BYTE *src_row;
     BYTE *dst_row;
     DWORD row;
@@ -127,7 +127,7 @@ static HRESULT process_update(struct ddraw_sample *sample, int stride, BYTE *poi
     dst_row = desc.lpSurface;
     for (row = sample->rect.top; row < sample->rect.bottom; ++row)
     {
-        memcpy(dst_row, src_row, row_size);
+        for (x = 0; x < row_size; x++) dst_row[x] = src_row[x];
         src_row += stride;
         dst_row += desc.lPitch;
     }
diff --git a/dlls/comctl32/idb_view_small.bmp:Zone.Identifier b/dlls/comctl32/idb_view_small.bmp:Zone.Identifier
deleted file mode 100644
index 60f0f978..00000000
--- a/dlls/comctl32/idb_view_small.bmp:Zone.Identifier
+++ /dev/null
@@ -1,3 +0,0 @@
-[ZoneTransfer]
-LastWriterPackageFamilyName=Microsoft.Windows.Photos_8wekyb3d8bbwe
-ZoneId=3
